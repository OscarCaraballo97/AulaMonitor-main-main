<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/app/users"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ pageTitle }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="userForm" (ngSubmit)="onSubmit()" *ngIf="userForm" class="max-w-lg mx-auto bg-white dark:bg-kwd-darker p-6 rounded-lg shadow-md">

    <ion-item lines="full" class="mb-4 rounded-md shadow-sm bg-gray-50 dark:bg-kwd-dark dark:text-kwd-light">
      <ion-label position="stacked">Nombre Completo <span class="text-red-500">*</span></ion-label>
      <ion-input type="text" formControlName="name"></ion-input>
    </ion-item>
    <div *ngIf="userForm.get('name')?.invalid && userForm.get('name')?.touched" class="text-xs text-red-600 mb-3 px-1">
      <small>El nombre es requerido (mínimo 3 caracteres).</small>
    </div>

    <ion-item lines="full" class="mb-4 rounded-md shadow-sm bg-gray-50 dark:bg-kwd-dark dark:text-kwd-light">
      <ion-label position="stacked">Correo Electrónico <span class="text-red-500">*</span></ion-label>
      <ion-input type="email" formControlName="email"></ion-input>
    </ion-item>
    <div *ngIf="userForm.get('email')?.invalid && userForm.get('email')?.touched" class="text-xs text-red-600 mb-3 px-1">
      <small>Correo inválido o requerido.</small>
    </div>

    <ion-item lines="full" class="mb-4 rounded-md shadow-sm bg-gray-50 dark:bg-kwd-dark dark:text-kwd-light">
      <ion-label position="stacked">
        Contraseña <span *ngIf="!isEditMode" class="text-red-500">*</span>
      </ion-label>
      <ion-input type="password" formControlName="password"></ion-input>
    </ion-item>
    <div *ngIf="userForm.get('password')?.invalid && userForm.get('password')?.touched" class="text-xs text-red-600 mb-3 px-1">
      <small>La contraseña es requerida.</small>
    </div>

    <ion-item lines="full" class="mb-4 rounded-md shadow-sm bg-gray-50 dark:bg-kwd-dark dark:text-kwd-light">
      <ion-label position="stacked">Rol <span class="text-red-500">*</span></ion-label>
      <ion-select formControlName="role" interface="popover" placeholder="Seleccionar Rol">
        <ion-select-option *ngFor="let roleOpt of rolesForSelect" [value]="roleOpt.value">
          {{ roleOpt.key | titlecase }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <div *ngIf="userForm.get('role')?.invalid && userForm.get('role')?.touched" class="text-xs text-red-600 mb-3 px-1">
      <small>El rol es requerido.</small>
    </div>

    <ion-item lines="full" class="mb-4 rounded-md shadow-sm bg-gray-50 dark:bg-kwd-dark dark:text-kwd-light">
      <ion-label position="stacked">Programa Académico <span class="text-red-500">*</span></ion-label>
      <ion-select formControlName="career" interface="popover" placeholder="Seleccionar Carrera">
        <ion-select-option *ngFor="let c of availableCareers" [value]="c">{{ c }}</ion-select-option>
      </ion-select>
    </ion-item>
    <div *ngIf="userForm.get('career')?.invalid && userForm.get('career')?.touched" class="text-xs text-red-600 mb-3 px-1">
      <small>La carrera es requerida.</small>
    </div>

    <ion-item lines="full" class="mb-4 rounded-md shadow-sm bg-gray-50 dark:bg-kwd-dark dark:text-kwd-light">
      <ion-label position="stacked">URL del Avatar (Opcional)</ion-label>
      <ion-input type="url" formControlName="avatarUrl"></ion-input>
    </ion-item>

    <div class="flex flex-col sm:flex-row justify-end pt-4 space-y-3 sm:space-y-0 sm:space-x-3 mt-6">
      <ion-button fill="outline" color="medium" (click)="cancel()">
        Cancelar
      </ion-button>

      <ion-button type="submit" [disabled]="userForm.invalid || isLoading" color="primary">
        <ion-spinner *ngIf="isLoading" name="dots" slot="start"></ion-spinner>
        {{ isEditMode ? 'Actualizar' : 'Crear Usuario' }}
      </ion-button>
    </div>

  </form>
</ion-content>
